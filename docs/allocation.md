# 分配算法（Doctor Allocation）

目标：为到达患者选择合适专科并生成按偏好排序的候选医生列表。

## 专科选择
- 专科集合：general / internal / pediatrics
- 患者的 `specialty_request` 视为真实需求，直接作为分配专科。

## 患者分组（16 类）
- 依据性别 (M/F)、年龄段 (AD/MA/SE/EL)、年访问频率高低 (V1=低, V2=高) 形成 16 组。
- 每组对应 `cp_group` 与 `cp_hours`（年消耗 = 年访问次数 × 0.5 小时），映射表见数据生成模块。
- 每次到达的 `service_minutes` 由 `cp_hours` 推导并用于调度/占用医生可用时间。

## 候选筛选
1. 过滤当前在岗的同专科医生（若医生 `hires_at` 在未来则跳过）。
2. 将患者与医生传入偏好算法（见 `preferences.md`）计算分数。
3. 首次到达：按分数降序确定首选医生，并记录为该患者“主治”。
4. 后续到达：优先尝试主治医生；若其在最晚接受日内无空档，再按偏好排序依次尝试其他医生。

## 输出
- 有序医生列表，供调度模块使用；列表首位为主治（若存在）。
- 若无可用医生，调度模块返回未分配的预约记录。
